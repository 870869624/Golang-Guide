![1762607418640](image/æ ‡å‡†é•œåƒæ„å»ºæµç¨‹/1762607418640.png)

å°†ä¸€ä¸ªGolangé¡¹ç›®æ‰“åŒ…æˆé•œåƒå¹¶åœ¨Kubernetesï¼ˆk8sï¼‰ä¸Šè¿è¡Œï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§æ­¥éª¤ï¼š**ä½¿ç”¨Dockerå°†Goåº”ç”¨æ‰“åŒ…æˆé•œåƒ**ï¼Œç„¶å**åœ¨Kubernetesé›†ç¾¤ä¸­éƒ¨ç½²å’Œè¿è¡Œè¿™ä¸ªé•œåƒ**ã€‚ä¸ºäº†è®©ä½ èƒ½å¿«é€Ÿä¸Šæ‰‹ï¼Œæˆ‘ä¸ºä½ æ¢³ç†äº†æ ‡å‡†æµç¨‹å’Œå…³é”®é…ç½®ã€‚

ä¸‹é¢æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„æ¦‚è§ˆï¼š

```mermaid
flowchart TD
    A[å¼€å§‹] --> B[ç¼–å†™Dockerfile]
    B --> C[æ„å»ºDockeré•œåƒ]
    C --> D[æ¨é€é•œåƒåˆ°ä»“åº“]
    D --> E[ç¼–å†™K8sé…ç½®æ–‡ä»¶]
    E --> F[éƒ¨ç½²åˆ°K8sé›†ç¾¤]
    F --> G{éƒ¨ç½²æˆåŠŸ?}
    G -- æ˜¯ --> H[è®¿é—®åº”ç”¨]
    G -- å¦ --> I[æ’æŸ¥é—®é¢˜]
    I --> F
```

### ğŸ“¦ å°†Goåº”ç”¨æ‰“åŒ…æˆDockeré•œåƒ

è¿™ä¸€æ­¥çš„ç›®æ ‡æ˜¯å°†ä½ çš„Goä»£ç å˜æˆä¸€ä¸ªå¯ä»¥éšå¤„è¿è¡Œçš„å®¹å™¨é•œåƒã€‚

#### 1. ç¼–å†™Dockerfile

ä¸€ä¸ªé«˜æ•ˆçš„æ ‡å‡†åšæ³•æ˜¯ä½¿ç”¨**å¤šé˜¶æ®µæ„å»º**ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°ä¸€ä¸ªéå¸¸å°å·§çš„é•œåƒã€‚å…·ä½“æ¥è¯´ï¼Œå…ˆåœ¨ä¸€ä¸ªå®Œæ•´çš„Goç¯å¢ƒä¸­ç¼–è¯‘ä»£ç ï¼Œç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åæŠŠè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶åˆ°ä¸€ä¸ªæç®€çš„åŸºç¡€é•œåƒï¼ˆæ¯”å¦‚`scratch`æˆ–`alpine`ï¼‰ä¸­è¿è¡Œã€‚

```Dockerfile
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºé˜¶æ®µï¼Œä½¿ç”¨Goå®˜æ–¹é•œåƒ
FROM golang:1.19-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app
# å¤åˆ¶ä¾èµ–æ–‡ä»¶å¹¶ä¸‹è½½ä¾èµ–
COPY go.mod go.sum ./
RUN go mod download
# å¤åˆ¶æºä»£ç å¹¶è¿›è¡Œç¼–è¯‘
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .

# ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œé˜¶æ®µï¼Œä»æç®€çš„scratché•œåƒå¼€å§‹
FROM scratch
# ä»æ„å»ºé˜¶æ®µå¤åˆ¶ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶
COPY --from=builder /app/main .
# å£°æ˜å®¹å™¨è¿è¡Œæ—¶æš´éœ²çš„ç«¯å£
EXPOSE 8080
# è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤
CMD ["./main"]
```

**å…³é”®ç‚¹è¯´æ˜ï¼š**
*   **å¤šé˜¶æ®µæ„å»º**ï¼šç¬¬ä¸€é˜¶æ®µ`builder`è´Ÿè´£ç¼–è¯‘ã€‚ç¬¬äºŒé˜¶æ®µ`scratch`æ˜¯ä¸€ä¸ªç©ºé•œåƒï¼ŒåªåŒ…å«æœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæå¤§åœ°å‡å°äº†é•œåƒä½“ç§¯ã€‚
*   **CGO_ENABLED=0**ï¼šç¦ç”¨CGOï¼Œç¼–è¯‘çº¯é™æ€çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿å…¶æ˜“äºåœ¨ä¸åŒLinuxç¯å¢ƒè¿è¡Œã€‚
*   **å°é•œåƒåŸºç¡€é€‰æ‹©**ï¼š`scratch`æ˜¯æœ€å°é€‰æ‹©ï¼Œä½†æ— æ³•æ‰§è¡ŒShellå‘½ä»¤ã€‚è‹¥éœ€è¦Shellç­‰åŸºç¡€å·¥å…·ï¼Œå¯æ¢ç”¨`alpine`ï¼ˆçº¦5MBï¼‰ã€‚

#### 2. æ„å»ºä¸æ¨é€é•œåƒ

åœ¨Dockerfileæ‰€åœ¨ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# æ„å»ºé•œåƒï¼Œ-tå‚æ•°æŒ‡å®šé•œåƒåç§°å’Œæ ‡ç­¾
docker build -t your-username/your-go-app:latest .

# ç™»å½•é•œåƒä»“åº“ï¼ˆå¦‚Docker Hubï¼‰
docker login

# æ¨é€é•œåƒåˆ°ä»“åº“
docker push your-username/your-go-app:latest
```

### ğŸš€ åœ¨Kubernetesä¸­éƒ¨ç½²é•œåƒ

ç°åœ¨ï¼Œä½ çš„åº”ç”¨å·²ç»æ‰“åŒ…æˆé•œåƒå¹¶æ¨é€åˆ°ä»“åº“ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è®©K8sé›†ç¾¤æ‹‰å–è¿™ä¸ªé•œåƒå¹¶è¿è¡Œå®ƒã€‚

#### 1. ç¼–å†™Kubernetesé…ç½®æ–‡ä»¶

ä½ éœ€è¦è‡³å°‘ä¸¤ä¸ªYAMLæ–‡ä»¶ï¼šä¸€ä¸ª**Deployment**å’Œä¸€ä¸ª**Service**ã€‚

**Deployment (deployment.yaml)**ï¼šè´Ÿè´£ä¿æŒæŒ‡å®šæ•°é‡çš„åº”ç”¨å‰¯æœ¬è¿è¡Œã€‚
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: your-go-app
spec:
  replicas: 3  # æŒ‡å®šå‰¯æœ¬æ•°é‡
  selector:
    matchLabels:
      app: your-go-app
  template:
    metadata:
      labels:
        app: your-go-app
    spec:
      containers:
      - name: your-go-app
        image: your-username/your-go-app:latest  # è¯·æ›¿æ¢ä¸ºä½ çš„å®é™…é•œåƒåœ°å€
        ports:
        - containerPort: 8080  # å®¹å™¨å†…åº”ç”¨ç›‘å¬çš„ç«¯å£
        # å»ºè®®æ·»åŠ èµ„æºé™åˆ¶
        resources:
          requests:
            memory: "64Mi"
            cpu: "250m"
          limits:
            memory: "128Mi"
            cpu: "500m"
        # å¼ºçƒˆå»ºè®®æ·»åŠ å¥åº·æ£€æŸ¥
        livenessProbe:
          httpGet:
            path: /healthz  # è¯·æ›¿æ¢ä¸ºä½ çš„åº”ç”¨å¥åº·æ£€æŸ¥ç«¯ç‚¹
            port: 8080
          initialDelaySeconds: 3
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready    # è¯·æ›¿æ¢ä¸ºä½ çš„åº”ç”¨å°±ç»ªæ£€æŸ¥ç«¯ç‚¹
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 10
```

**Service (service.yaml)**ï¼šä¸ºä½ çš„åº”ç”¨æä¾›ä¸€ä¸ªç¨³å®šçš„ç½‘ç»œè®¿é—®å…¥å£ã€‚
```yaml
apiVersion: v1
kind: Service
metadata:
  name: your-go-app-service
spec:
  selector:
    app: your-go-app  # è¿™ä¸ªé€‰æ‹©å™¨éœ€è¦åŒ¹é…Deploymentä¸­Podçš„æ ‡ç­¾
  ports:
    - protocol: TCP
      port: 80        # Serviceå¯¹å¤–æœåŠ¡çš„ç«¯å£
      targetPort: 8080 # å°†æµé‡è½¬å‘åˆ°å®¹å™¨çš„è¿™ä¸ªç«¯å£
  type: LoadBalancer  # å¦‚æœæ˜¯äº‘æœåŠ¡å•†ï¼Œè¿™ä¼šåˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨
  # å¯¹äºé›†ç¾¤å†…è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨ ClusterIP ç±»å‹
```

#### 2. éƒ¨ç½²åˆ°Kubernetesé›†ç¾¤

ä½¿ç”¨`kubectl`å‘½ä»¤è¡Œå·¥å…·åº”ç”¨é…ç½®æ–‡ä»¶ã€‚

```bash
# åº”ç”¨Deploymentå’ŒServiceé…ç½®
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml

# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
kubectl get deployments
kubectl get pods
kubectl get services
```

### ğŸ’¡ ç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸æœ€ä½³å®è·µ

1.  **å¥åº·æ£€æŸ¥ (Health Checks)**ï¼šåŠ¡å¿…å¦‚ä¸Šé¢YAMLæ‰€ç¤ºï¼Œé…ç½®`livenessProbe`å’Œ`readinessProbe`ï¼Œè¿™æ˜¯K8sç®¡ç†åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„å…³é”®ã€‚
2.  **èµ„æºé…ç½® (Resource Limits)**ï¼šä¸ºå®¹å™¨è®¾ç½®CPUå’Œå†…å­˜çš„è¯·æ±‚(`requests`)å’Œé™åˆ¶(`limits`)ï¼Œé¿å…å•ä¸ªåº”ç”¨è€—å°½é›†ç¾¤èµ„æºã€‚
3.  **ç§æœ‰é•œåƒä»“åº“è®¤è¯**ï¼šå¦‚æœä½¿ç”¨ç§æœ‰é•œåƒä»“åº“ï¼Œéœ€è¦åœ¨K8sä¸­åˆ›å»ºä¸€ä¸ª`Secret`æ¥å­˜å‚¨è®¤è¯ä¿¡æ¯ï¼Œå¹¶åœ¨Deploymentä¸­å¼•ç”¨å®ƒã€‚
4.  **ä½¿ç”¨CI/CDè‡ªåŠ¨åŒ–**ï¼šç»“åˆJenkinsã€GitLab CIã€äº‘æ•ˆç­‰å·¥å…·ï¼Œå¯ä»¥å®ç°ä»£ç æäº¤åè‡ªåŠ¨æ„å»ºã€æµ‹è¯•ã€æ‰“åŒ…å’Œéƒ¨ç½²çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚

### ğŸ› ï¸ é‡åˆ°é—®é¢˜æ€ä¹ˆåŠï¼Ÿ

å¦‚æœéƒ¨ç½²ååº”ç”¨æ— æ³•è®¿é—®ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

```bash
# æŸ¥çœ‹Podçš„çŠ¶æ€
kubectl get pods
# æŸ¥çœ‹Podçš„è¯¦ç»†æè¿°
kubectl describe pod <pod-name>
# æŸ¥çœ‹Podçš„æ—¥å¿—
kubectl logs <pod-name>
```

å¸Œæœ›è¿™ä»½è¯¦ç»†çš„æŒ‡å—èƒ½å¸®åŠ©ä½ é¡ºåˆ©å®ŒæˆGoåº”ç”¨åœ¨K8sä¸Šçš„éƒ¨ç½²ï¼å¦‚æœä½ åœ¨å®è·µè¿‡ç¨‹ä¸­é‡åˆ°æ›´å…·ä½“çš„é—®é¢˜ï¼Œæ¯”å¦‚å¦‚ä½•é…ç½®ç‰¹å®šçš„å¥åº·æ£€æŸ¥æ¥å£ï¼Œæˆ–è€…å¦‚ä½•ç®¡ç†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥éšæ—¶æå‡ºã€‚