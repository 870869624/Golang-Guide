很好！为了确保可以回滚，你需要保存当前正在运行的cleansvc镜像。以下是详细步骤：

## 方法1：从正在运行的Pod导出镜像（推荐）

### 步骤1：找到当前运行的镜像
```bash
# 查看当前cleansvc使用的镜像
kubectl get deployment cleansvc -n sdsp -o yaml | grep image:

# 或者查看Pod的镜像
kubectl describe pod cleansvc-7dc5b6d855-rrfzc -n sdsp | grep Image:
```

### 步骤2：从Docker中保存当前镜像
```bash
# 登录到运行cleansvc Pod的节点
# 首先找到Pod运行在哪个节点
kubectl get pod cleansvc-7dc5b6d855-rrfzc -n sdsp -o wide

# 登录到该节点，然后查找镜像
docker images | grep cleansvc

# 保存当前镜像
docker save -o cleansvc-backup-$(date +%Y%m%d-%H%M%S).tar <image-name>:<tag>

# 例如：
docker save -o cleansvc-backup.tar cleansvc:current-version

[root@node01 ~]# kubectl get pod cleansvc-59978d465c-mssxk -n sdsp -o wide
NAME                        READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES
cleansvc-59978d465c-mssxk   2/2     Running   0          26h   10.42.0.138   node01   <none>           <none>
[root@node01 ~]# 
[root@node01 ~]# docker images | grep cleansvc
docker-hub.cloud.top/aiop/cleansvc-arm64        latest              140de67af82c        33 hours ago        67.4MB
docker-hub.cloud.top/aiop/cleansvc-arm64        <none>              14543e7786ba        2 days ago          67.4MB
docker-hub.cloud.top/aiop/cleansvc-arm64        <none>              429237db40b9        2 days ago          67.4MB
[root@node01 ~]# docker save -o cleansvc-backup.tar docker-hub.cloud.top/aiop/cleansvc-arm64:latest
[root@node01 ~]# 
```

## 方法2：完整的备份方案

### 步骤1：备份所有相关资源
```bash
# 创建备份目录
mkdir -p cleansvc-backup-$(date +%Y%m%d)
cd cleansvc-backup-$(date +%Y%m%d)

# 1. 备份Deployment配置
kubectl get deployment cleansvc -n sdsp -o yaml > deployment-backup.yaml

# 2. 备份Service配置（如果有）
kubectl get service -n sdsp | grep cleansvc && \
kubectl get service cleansvc -n sdsp -o yaml > service-backup.yaml

# 3. 备份ConfigMap和Secret（如果有）
kubectl get configmap -n sdsp | grep cleansvc && \
kubectl get configmap <configmap-name> -n sdsp -o yaml > configmap-backup.yaml

kubectl get secret -n sdsp | grep cleansvc && \
kubectl get secret <secret-name> -n sdsp -o yaml > secret-backup.yaml

# 4. 备份当前Pod描述
kubectl get pod cleansvc-7dc5b6d855-rrfzc -n sdsp -o yaml > pod-backup.yaml
```

### 步骤2：保存当前Docker镜像
```bash
# 获取当前镜像名称和标签
CURRENT_IMAGE=$(kubectl get deployment cleansvc -n sdsp -o jsonpath='{.spec.template.spec.containers[0].image}')

echo "当前镜像: $CURRENT_IMAGE"

# 保存镜像
docker save -o cleansvc-image-backup.tar $CURRENT_IMAGE

# 也保存为latest标签的备份
docker tag $CURRENT_IMAGE cleansvc:backup
docker save -o cleansvc-latest-backup.tar cleansvc:backup
```

## 方法3：使用脚本自动化备份

创建备份脚本 `backup-cleansvc.sh`：
```bash
#!/bin/bash
set -e

BACKUP_DIR="cleansvc-backup-$(date +%Y%m%d-%H%M%S)"
mkdir -p $BACKUP_DIR
cd $BACKUP_DIR

echo "=== 开始备份cleansvc ==="

# 获取当前镜像信息
CURRENT_IMAGE=$(kubectl get deployment cleansvc -n sdsp -o jsonpath='{.spec.template.spec.containers[0].image}')
echo "当前镜像: $CURRENT_IMAGE"

# 备份K8s资源
echo "1. 备份K8s资源..."
kubectl get deployment cleansvc -n sdsp -o yaml > deployment.yaml
kubectl get pod -n sdsp -l app=cleansvc -o yaml > pods.yaml

# 查找相关ConfigMap和Secret
kubectl get configmap -n sdsp -o yaml > configmaps.yaml
kubectl get secret -n sdsp -o yaml > secrets.yaml

# 备份镜像
echo "2. 备份Docker镜像..."
docker save -o cleansvc-backup.tar $CURRENT_IMAGE

# 创建备份信息文件
cat > backup-info.txt << EOF
备份时间: $(date)
当前镜像: $CURRENT_IMAGE
Pod: $(kubectl get pod -n sdsp -l app=cleansvc -o jsonpath='{.items[0].metadata.name}')
节点: $(kubectl get pod -n sdsp -l app=cleansvc -o jsonpath='{.items[0].spec.nodeName}')
EOF

echo "3. 验证备份..."
tar -tzf cleansvc-backup.tar > /dev/null && echo "镜像备份验证成功" || echo "镜像备份验证失败"

echo "=== 备份完成 ==="
echo "备份文件保存在: $(pwd)"
ls -la
```

## 方法4：如果无法直接访问镜像的备选方案

如果无法直接访问Docker镜像，可以备份当前运行的二进制文件：

```bash
# 从运行中的Pod拷贝二进制文件
kubectl cp sdsp/cleansvc-7dc5b6d855-rrfzc:/app/cleansvc ./cleansvc-binary-backup

# 备份配置文件
kubectl cp sdsp/cleansvc-7dc5b6d855-rrfzc:/app/config ./config-backup/ -c <container-name>
```

## 完整的回滚方案

### 回滚脚本 `rollback-cleansvc.sh`
```bash
#!/bin/bash
set -e

BACKUP_DIR="$1"
if [ -z "$BACKUP_DIR" ]; then
    echo "用法: $0 <备份目录>"
    echo "可用的备份:"
    ls -d cleansvc-backup-* 2>/dev/null || echo "未找到备份目录"
    exit 1
fi

cd $BACKUP_DIR

echo "=== 开始回滚cleansvc ==="

# 停止当前部署（避免冲突）
echo "1. 停止当前部署..."
kubectl scale deployment cleansvc -n sdsp --replicas=0

# 加载备份的镜像
echo "2. 加载备份镜像..."
docker load -i cleansvc-backup.tar

# 恢复Deployment
echo "3. 恢复Deployment配置..."
kubectl apply -f deployment.yaml

# 等待部署完成
echo "4. 等待部署就绪..."
kubectl rollout status deployment/cleansvc -n sdsp --timeout=300s

echo "=== 回滚完成 ==="
kubectl get pods -n sdsp -l app=cleansvc
```

## 实际操作步骤

### 立即执行的备份命令：
```bash
# 1. 快速备份当前镜像信息
CURRENT_IMAGE=$(kubectl get deployment cleansvc -n sdsp -o jsonpath='{.spec.template.spec.containers[0].image}')
echo "当前镜像: $CURRENT_IMAGE"

# 2. 保存这个镜像（在运行Pod的节点上执行）
docker save -o /tmp/cleansvc-backup-$(date +%Y%m%d).tar $CURRENT_IMAGE

# 3. 备份Deployment配置
kubectl get deployment cleansvc -n sdsp -o yaml > cleansvc-deployment-backup.yaml

# 4. 记录当前状态
kubectl get pod cleansvc-7dc5b6d855-rrfzc -n sdsp -o wide > cleansvc-current-status.txt
```

### 验证备份：
```bash
# 验证镜像文件
docker load -i /tmp/cleansvc-backup-*.tar

# 验证配置文件
kubectl apply -f cleansvc-deployment-backup